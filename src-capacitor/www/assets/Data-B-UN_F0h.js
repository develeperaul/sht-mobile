import{_ as J}from"./BaseButton-BEwq3IU_.js";import{_ as le}from"./CodeInput-DOZXPm6j.js";import{_ as K}from"./BaseIcon.vue_vue_type_script_setup_true_lang-Y1ZGA_hf.js";import{d as G,ak as N,y as F,aj as ae,Z as E,a1 as I,J as W,e as R,o as s,a3 as oe,K as r,w as b,c as p,Q as c,a as t,f as C,t as y,M as e,aa as se,al as de,_ as Q,am as pe,P as ue,an as L,a0 as me,B as O,F as U,b as ee,n as H,L as we,U as te,X as ce,ao as ve,Y as fe}from"./index-Cu7ORWtZ.js";import{_ as _e}from"./BaseInput-obryhwg8.js";import{C as he,a as ge,b as ye}from"./index-BJCVfGh_.js";import{_ as be}from"./HeadBlock.vue_vue_type_script_setup_true_lang-EQZJWHOA.js";import{Q as ke}from"./QPage-CDrjN61Q.js";import"./QSpinnerTail-Co0JQqD5.js";import"./vee-validate-DgmE1SLv.js";const xe={key:0,class:"popup"},Ce={class:"popup__wrapper"},$e={class:"popup__content"},Fe={class:"p1 tw-text-center"},Be=G({__name:"VerifyPhone",props:N({phone:{}},{modelValue:{},modelModifiers:{}}),emits:N(["update"],["update:modelValue"]),setup(_,{emit:o}){const d=_,w=o,n=F(!0),v=ae(_,"modelValue"),{profile:m}=E(I()),h=async g=>{try{await de(`+7${d.phone}`,g.kod),m.value&&await I().update({first_name:m.value.first_name??"",last_name:m.value.last_name??"",patronymic:m.value.patronymic??"",birthday:m.value.birthday??"",phone:`+7${d.phone}`}),w("update")}catch(a){throw a}};return(g,a)=>{const k=K,x=le,M=J,S=W("Form");return s(),R(oe,{to:"body"},[r(se,{name:"fade"},{default:b(()=>[v.value?(s(),p("div",xe,[t("div",Ce,[r(k,{name:"close",class:"popup__close tw-mr-0 tw-ml-auto",onClick:a[0]||(a[0]=q=>v.value=!1)}),t("div",$e,[r(S,{class:"card-white tw-grid tw-gap-[23px] tw-mt-[32.5px]",onSubmit:h},{default:b(()=>[a[6]||(a[6]=t("div",{class:"h2 tw-text-center"},"Подтвердите телефон",-1)),t("div",Fe,[a[3]||(a[3]=C(" Введите код из смс ",-1)),a[4]||(a[4]=t("br",null,null,-1)),C(" +7"+y(g.phone),1)]),r(x,{class:"tw-flex tw-justify-center",onFilled:a[1]||(a[1]=q=>n.value=!1),onUnfilled:a[2]||(a[2]=q=>n.value=!0)}),a[7]||(a[7]=t("div",{class:"tw-mb-6 tw-mt-6"},[t("div",{class:"link p2 tw-text-center"},"Не получили код?")],-1)),r(M,{disabled:e(n)},{default:b(()=>[...a[5]||(a[5]=[C(" Отправить ",-1)])]),_:1},8,["disabled"])]),_:1})])])])):c("",!0)]),_:1})])}}}),Pe=Q(Be,[["__scopeId","data-v-8ae856a7"]]),Ve={key:0,class:"popup"},Me={class:"popup__wrapper"},Se={class:"popup__content"},qe={class:"p1 tw-text-center"},Ue=G({__name:"VerifyMail",props:N({mail:{}},{modelValue:{},modelModifiers:{}}),emits:N(["update"],["update:modelValue"]),setup(_,{emit:o}){const d=_,w=o,n=F(!0),v=ae(_,"modelValue"),{profile:m}=E(I()),h=async g=>{try{await pe(d.mail,g.kod),m.value&&await I().update({first_name:m.value.first_name??"",last_name:m.value.last_name??"",patronymic:m.value.patronymic??"",birthday:m.value.birthday??"",phone:m.value.phone??"",email:d.mail}),w("update")}catch(a){throw a}};return(g,a)=>{const k=K,x=le,M=J,S=W("Form");return s(),R(oe,{to:"body"},[r(se,{name:"fade"},{default:b(()=>[v.value?(s(),p("div",Ve,[t("div",Me,[r(k,{name:"close",class:"popup__close tw-mr-0 tw-ml-auto",onClick:a[0]||(a[0]=q=>v.value=!1)}),t("div",Se,[r(S,{class:"card-white tw-grid tw-gap-[23px] tw-mt-[32.5px]",onSubmit:h},{default:b(()=>[a[6]||(a[6]=t("div",{class:"h2 tw-text-center"},"Подтвердите почту",-1)),t("div",qe,[a[3]||(a[3]=C(" Введите код из почтового ящика ",-1)),a[4]||(a[4]=t("br",null,null,-1)),C(" "+y(g.mail),1)]),r(x,{class:"tw-flex tw-justify-center",onFilled:a[1]||(a[1]=q=>n.value=!1),onUnfilled:a[2]||(a[2]=q=>n.value=!0)}),a[7]||(a[7]=t("div",{class:"tw-mb-6 tw-mt-6"},[t("div",{class:"p1"}," Если не пришло письмо, проверьте папку «Спам» "),t("div",{class:"link p2 tw-text-center"},"Не получили код?")],-1)),r(M,{disabled:e(n)},{default:b(()=>[...a[5]||(a[5]=[C(" Отправить ",-1)])]),_:1},8,["disabled"])]),_:1})])])])):c("",!0)]),_:1})])}}}),Ie=Q(Ue,[["__scopeId","data-v-3e1f1a24"]]);async function je(_,o=1280,d=1280,w=.8){if(!_.type.startsWith("image/"))return _;const n=await new Promise((j,D)=>{const $=new FileReader;$.onload=()=>j($.result),$.onerror=D,$.readAsDataURL(_)}),v=await new Promise((j,D)=>{const $=new Image;$.onload=()=>j($),$.onerror=D,$.src=n});let{width:m,height:h}=v;if(m<=o&&h<=d)return _;const g=Math.min(o/m,d/h);m=Math.round(m*g),h=Math.round(h*g);const a=document.createElement("canvas");a.width=m,a.height=h;const k=a.getContext("2d");if(!k)return _;k.drawImage(v,0,0,m,h);const x=await new Promise(j=>a.toBlob(D=>j(D),"image/jpeg",w));if(!x)return _;const M="jpg",S=_.name.replace(/\.[^/.]+$/,"");return new File([x],`${S}-compressed.${M}`,{type:"image/jpeg"})}const De={key:0,class:"file-img"},Le=["src"],Re={key:1},Te=G({__name:"File",props:{id:{},url:{},noimg:{type:Boolean,default:!0}},emits:["fileLoad","deleteFile"],setup(_,{emit:o}){const d=o,w=async()=>{try{const n=await he.getPhoto({quality:90,resultType:ye.DataUrl,source:ge.Prompt});if(!n.dataUrl)return;const m=await(await fetch(n.dataUrl)).blob(),h=m.type.split("/")[1]||"jpg",g=new File([m],`photo.${h}`,{type:m.type}),a=await je(g,1280,1280,.8);d("fileLoad",a)}catch(n){console.log("Camera cancelled or error",n)}};return(n,v)=>n.id?(s(),p("div",De,[t("div",{class:"file-img__btn",onClick:v[0]||(v[0]=m=>d("deleteFile",n.id))},[...v[1]||(v[1]=[t("svg",{width:"33",height:"33",viewBox:"0 0 33 33",fill:"none"},[t("path",{d:"M29.4519 16.0645C29.4519 23.458 23.4583 29.4516 16.0648 29.4516C8.67134 29.4516 2.67773 23.458 2.67773 16.0645C2.67773 8.67104 8.67134 2.67743 16.0648 2.67743C23.4583 2.67743 29.4519 8.67104 29.4519 16.0645Z",fill:"#FF3B30"}),t("path",{d:"M7.9668 16H23.1126",stroke:"white","stroke-width":"2.00806","stroke-linecap":"round"})],-1)])]),n.url?(s(),p("img",{key:0,src:n.url,alt:""},null,8,Le)):c("",!0)])):(s(),p("div",Re,[(s(),p("svg",{onClick:w,width:"120",height:"120",fill:"none",viewBox:"0 0 120 120"},[...v[2]||(v[2]=[ue('<rect width="120" height="119.008" rx="30" fill="white" data-v-e2fe56f6></rect><g clip-path="url(#clip0_321_8590)" data-v-e2fe56f6><g clip-path="url(#clip1_321_8590)" data-v-e2fe56f6><path d="M81.5481 59.9355C81.5481 71.872 71.8716 81.5484 59.9352 81.5484C47.9987 81.5484 38.3223 71.872 38.3223 59.9355C38.3223 47.999 47.9987 38.3226 59.9352 38.3226C71.8716 38.3226 81.5481 47.999 81.5481 59.9355Z" fill="#C6D9F1" data-v-e2fe56f6></path><path d="M46.9678 59.9355H71.42" stroke="white" stroke-width="3.24194" stroke-linecap="round" stroke-linejoin="round" data-v-e2fe56f6></path><path d="M59.1924 46.9677V71.42" stroke="white" stroke-width="3.24194" stroke-linecap="round" stroke-linejoin="round" data-v-e2fe56f6></path></g></g><defs data-v-e2fe56f6><clipPath id="clip0_321_8590" data-v-e2fe56f6><rect width="51.871" height="51.871" fill="white" transform="translate(34 34)" data-v-e2fe56f6></rect></clipPath><clipPath id="clip1_321_8590" data-v-e2fe56f6><rect width="51.871" height="51.871" fill="white" transform="translate(34 34)" data-v-e2fe56f6></rect></clipPath></defs>',3)])]))]))}}),Ne=Q(Te,[["__scopeId","data-v-e2fe56f6"]]),Ee=["onClick","onBlur"],Ge={class:"edit-block"},Qe=["onClick"],Ze={key:0,class:"tw-grid tw-gap-2"},ze={class:"tw-grid tw-gap-2"},Ae={key:1,class:"tw-grid tw-gap-6"},He={class:"tw-grid tw-gap-2"},Je={key:0,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},Ke={key:1,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},We={class:"tw-grid tw-gap-2"},Xe={key:0,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},Ye={key:1,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},Oe={key:2,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},et={key:3,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},tt={key:0,class:"tw-grid tw-gap-2"},lt={class:"tw-grid tw-gap-2"},at={key:1,class:"tw-grid tw-gap-6"},ot={class:"tw-grid tw-gap-2"},st={key:0,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},nt={class:"tw-grid tw-gap-2"},it={key:0,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},rt={key:1,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},dt={key:2,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},pt={key:3,class:"p1 tw-rounded-[60px] tw-bg-white tw-h-[52px] tw-px-4 tw-flex tw-items-center"},ut={key:0,class:"tw-grid tw-gap-2"},mt={class:"tw-grid tw-gap-2"},wt=G({__name:"Data",setup(_){const{profile:o}=E(I()),{friends:d}=E(L());me(async()=>{await Promise.allSettled([L().setFriends(),I().setProfile()])}),O(d,i=>{const l=L().friends.length;for(let P=1;P<=l;P++)w.value.splice(P,1,{open:!1,trash:!1,edit:!1})});const w=F([{open:!1,trash:!1,edit:!0}]),n=F(0);O(n,i=>{w.value.splice(i,1,{open:!1,trash:!1,edit:!1})}),F(!0);const v=F({x:0,y:0}),m=(i,l)=>{const P=i.target;console.log(P.getBoundingClientRect()),v.value={x:P.getBoundingClientRect().left,y:P.getBoundingClientRect().top},w.value.splice(l,1,{open:!0,trash:!1,edit:!1})},h=i=>{w.value.splice(i,1,{open:!1,trash:!1,edit:!1})},g=i=>{w.value.splice(i,1,{open:!1,trash:!1,edit:!0})},a=()=>{w.value.push({open:!1,trash:!1,edit:!1}),n.value=w.value.length-1},k=F(!1),x=F(!1),M=F(""),S=F(""),q=async i=>{await I().update({...i,phone:"+7"+i.phone}),console.log(o.value?.email!==i.email||o.value?.email===null&&i.email!==null),o.value?.email!==i.email&&i.email!==null&&i.email.length>0&&(console.log(i.email.length>0),M.value=i.email,k.value=!0),o.value?.phone!=="+7"+i.phone&&i.phone!==null&&i.phone.length>0&&(S.value=i.phone,x.value=!0)},j=i=>{L().create({...i,phone:"+7"+i.phone}).then(l=>{L().setFriends()})},D=async i=>{if(n.value!==0&&d.value.length>0){const l=d.value[n.value-1];l&&(console.log(i),await L().update(l.id,{...i,phone:"+7"+i.phone}))}},$=async()=>{if(n.value!==0&&d.value.length>0){const i=d.value[n.value-1];i&&(await L().remove(i.id),w.value.splice(n.value,1),n.value=w.value.length-1)}},T=F(""),X=async i=>{try{T.value=(await ce(i)).data.id,o.value=(await ve(T.value)).data}catch(l){throw l}},ne=async i=>{try{await fe(i),await I().setProfile(),T.value=""}catch(l){throw l}};return(i,l)=>{const P=be,Z=K,Y=Ne,f=_e,z=J,A=W("Form"),ie=Ie,re=Pe;return s(),R(ke,{class:"tw-container"},{default:b(()=>[r(P,{title:"Личные данные",class:"tw-mb-3"}),t("div",null,[t("div",null,[t("div",{class:"tw-flex tw-gap-2 tw-overflow-auto no-scrollbar tw-mb-6",onScroll:l[0]||(l[0]=V=>h(e(n)))},[(s(!0),p(U,null,ee(e(w),(V,u)=>(s(),p("div",{class:H(["p1 tw-flex tw-items-center tw-gap-2 tw-px-3 tw-py-1 tw-rounded-[60px] tw-w-fit tw-shrink-0",e(n)===u?"tw-bg-blue_main":"tw-bg-white"]),onClick:B=>n.value=u,onBlur:B=>h(u),tabindex:-1},[C(" Гость №"+y(u+1)+" ",1),t("div",Ge,[r(Z,{onClick:B=>m(B,u),name:"dots",class:"tw-w-[27px] tw-h-[30px] tw-text-gray_main"},null,8,["onClick"]),t("div",{class:H(["edit-block__popup",V.open?"active":""]),style:we({left:`${e(v).x}px`})},[e(n)!==0?(s(),p("div",{key:0,class:"tw-flex tw-gap-2.5 tw-items-center tw-h-[50px] tw-px-5 round",onClick:$},[r(Z,{name:"trash",class:"tw-w-6 tw-h-6 tw-text-blue_icon"}),l[5]||(l[5]=C(" Удалить гостя ",-1))])):c("",!0),t("div",{class:H(["tw-flex tw-gap-2.5 tw-items-center tw-h-[50px] tw-px-5",e(n)===0?"tw-rounded-[30px]":"tw-bg-[#C6D9F166] tw-rounded-b-[30px]"]),onClick:B=>g(u)},[r(Z,{name:"edit",class:"tw-w-6 tw-h-6 tw-text-blue_icon"}),l[6]||(l[6]=C(" Редактировать ",-1))],10,Qe)],6)])],42,Ee))),256)),t("div",{class:"tw-w-[38px] tw-h-[38px] tw-rounded-full h2 tw-grid tw-place-content-center tw-bg-white tw-shrink-0",onClick:a}," + ")],32)]),(s(!0),p(U,null,ee(e(w),(V,u)=>(s(),p(U,null,[u===0?(s(),p(U,{key:0},[e(n)===u?(s(),p(U,{key:0},[e(w)[e(n)]?.edit?(s(),R(A,{key:0,onSubmit:B=>q(B,u),class:"tw-grid tw-gap-6"},{default:b(()=>[t("div",null,[l[7]||(l[7]=t("div",{class:"p1 tw-mb-[25px]"},"Фото",-1)),r(Y,{onFileLoad:X,onDeleteFile:ne,id:e(o).avatar?e(o).avatar.id:void 0,url:e(o)?.avatar?e(o)?.avatar.url:void 0},null,8,["id","url"])]),t("div",null,[l[8]||(l[8]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),e(o)?(s(),p("div",Ze,[r(f,{"model-value":e(o).phone??"","un-mask":"",maska:"+7 (###)-###-##-##",name:"phone",placeholder:"Телефон",rules:"required|cellphone"},null,8,["model-value"]),r(f,{"model-value":e(o).email??"",name:"email",rules:"required|email",placeholder:"Почта"},null,8,["model-value"])])):c("",!0)]),t("div",null,[l[9]||(l[9]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),t("div",ze,[r(f,{"model-value":e(o)?.first_name??"",name:"last_name",rules:"required",placeholder:"Имя*"},null,8,["model-value"]),r(f,{"model-value":e(o)?.last_name??"",name:"first_name",rules:"required",placeholder:"Фамилия*"},null,8,["model-value"]),r(f,{"model-value":e(o)?.patronymic??"",name:"patronymic",rules:"required",placeholder:"Отчество*"},null,8,["model-value"]),r(f,{"model-value":e(o)?.birthday??"",name:"birthday",maska:"##.##.####",rules:"required",placeholder:"Дата рождения*"},null,8,["model-value"])])]),r(z,null,{default:b(()=>[...l[10]||(l[10]=[C("Сохранить",-1)])]),_:1})]),_:2},1032,["onSubmit"])):(s(),p("div",Ae,[t("div",null,[l[11]||(l[11]=t("div",{class:"p1 tw-mb-[25px]"},"Фото",-1)),r(Y,{onFileLoad:X,id:e(T)??e(o).avatar.id,url:e(o)?.avatar??""},null,8,["id","url"])]),t("div",null,[l[12]||(l[12]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),t("div",He,[e(o)?.phone?(s(),p("div",Je,y(e(o).phone),1)):c("",!0),e(o)?.email?(s(),p("div",Ke,y(e(o).email),1)):c("",!0)])]),t("div",null,[l[13]||(l[13]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),t("div",We,[e(o)?.last_name?(s(),p("div",Xe,y(e(o).last_name),1)):c("",!0),e(o)?.first_name?(s(),p("div",Ye,y(e(o).first_name),1)):c("",!0),e(o)?.patronymic?(s(),p("div",Oe,y(e(o).patronymic),1)):c("",!0),e(o)?.birthday?(s(),p("div",et,y(e(o).birthday),1)):c("",!0)])])]))],64)):c("",!0)],64)):(s(),p(U,{key:1},[e(n)===u?(s(),p(U,{key:0},[e(d)&&e(d)[u-1]?(s(),p(U,{key:0},[e(w)[e(n)]?.edit?(s(),R(A,{key:0,onSubmit:B=>D(B,u-1),class:"tw-grid tw-gap-6"},{default:b(()=>[t("div",null,[l[14]||(l[14]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),e(o)?(s(),p("div",tt,[r(f,{"model-value":e(d)[u-1].phone??"","un-mask":"",maska:"+7 (###)-###-##-##",name:"phone",placeholder:"Телефон"},null,8,["model-value"])])):c("",!0)]),t("div",null,[l[15]||(l[15]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),t("div",lt,[r(f,{"model-value":e(d)[u-1]?.first_name??"",name:"last_name",rules:"required",placeholder:"Имя*"},null,8,["model-value"]),r(f,{"model-value":e(d)[u-1]?.last_name??"",name:"first_name",rules:"required",placeholder:"Фамилия*"},null,8,["model-value"]),r(f,{"model-value":e(d)[u-1]?.patronymic??"",name:"patronymic",rules:"required",placeholder:"Отчество*"},null,8,["model-value"]),r(f,{"model-value":e(d)[u-1]?.birthday??"",name:"birthday",maska:"##.##.####",rules:"required",placeholder:"Дата рождения*"},null,8,["model-value"])])]),r(z,null,{default:b(()=>[...l[16]||(l[16]=[C("Сохранить",-1)])]),_:1})]),_:2},1032,["onSubmit"])):(s(),p("div",at,[t("div",null,[l[17]||(l[17]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),t("div",ot,[e(d)[u-1]?.phone?(s(),p("div",st,y(e(d)[u-1].phone),1)):c("",!0)])]),t("div",null,[l[18]||(l[18]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),t("div",nt,[e(d)[u-1]?.last_name?(s(),p("div",it,y(e(d)[u-1].last_name),1)):c("",!0),e(d)[u-1]?.first_name?(s(),p("div",rt,y(e(d)[u-1].first_name),1)):c("",!0),e(d)[u-1]?.patronymic?(s(),p("div",dt,y(e(d)[u-1].patronymic),1)):c("",!0),e(d)[u-1]?.birthday?(s(),p("div",pt,y(e(d)[u-1].birthday),1)):c("",!0)])])]))],64)):(s(),R(A,{key:1,onSubmit:B=>j(B,u),class:"tw-grid tw-gap-6"},{default:b(()=>[t("div",null,[l[19]||(l[19]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),e(o)?(s(),p("div",ut,[r(f,{"un-mask":"",maska:"+7 (###)-###-##-##",name:"phone",placeholder:"Телефон"})])):c("",!0)]),t("div",null,[l[20]||(l[20]=t("div",{class:"p1 tw-mb-[25px]"},"Контактная информация",-1)),t("div",mt,[r(f,{name:"last_name",rules:"required",placeholder:"Имя*"}),r(f,{name:"first_name",rules:"required",placeholder:"Фамилия*"}),r(f,{name:"patronymic",rules:"required",placeholder:"Отчество*"}),r(f,{name:"birthday",maska:"##.##.####",rules:"required",placeholder:"Дата рождения*"})])]),r(z,null,{default:b(()=>[...l[21]||(l[21]=[C("Сохранить",-1)])]),_:1})]),_:2},1032,["onSubmit"]))],64)):c("",!0)],64))],64))),256))]),r(ie,{modelValue:e(k),"onUpdate:modelValue":l[1]||(l[1]=V=>te(k)?k.value=V:null),mail:e(M),onUpdate:l[2]||(l[2]=V=>k.value=!1)},null,8,["modelValue","mail"]),r(re,{modelValue:e(x),"onUpdate:modelValue":l[3]||(l[3]=V=>te(x)?x.value=V:null),phone:e(S),onUpdate:l[4]||(l[4]=V=>x.value=!1)},null,8,["modelValue","phone"])]),_:1})}}}),Ct=Q(wt,[["__scopeId","data-v-249d5ac3"]]);export{Ct as default};
